<!doctype html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<title>Cartes Rockin</title>

<style>
body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica;
  background:#111;
  color:white;
  text-align:center;
  margin:0;
  padding:20px;
}

h1{
  margin:0 0 15px 0;
  font-size:28px;
}

.controls{
  margin-bottom:15px;
}

select, button{
  font-size:18px;
  padding:10px 16px;
  border-radius:12px;
  margin:6px;
  cursor:pointer;
}

button{
  background:#ffcc00;
  border:none;
  font-weight:bold;
}

button:hover{
  background:#ffd84d;
}

img{
  max-width:95%;
  max-height:75vh;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.6);
}

.info{
  margin-top:10px;
  opacity:.7;
  font-size:14px;
}
</style>
</head>

<body>

<h1> Cartes Rockin</h1>

<div class="controls">
  <select id="deck"></select>
  <button onclick="novaCarta()">Nova carta</button>
</div>

<img id="img">
<div class="info">Prem ENTER per treure una nova carta</div>

<script>
let MANIFEST = {}
let barallaActual = []
let barallaRestant = []

// barrejar array (Fisher-Yates)
function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1))
    ;[array[i],array[j]]=[array[j],array[i]]
  }
  return array
}

// carregar manifest
async function init(){
  const res = await fetch("manifest.json")
  MANIFEST = await res.json()

  const select = document.getElementById("deck")

  Object.keys(MANIFEST).forEach(b=>{
    const opt=document.createElement("option")
    opt.value=b
    opt.textContent=b
    select.appendChild(opt)
  })

  select.addEventListener("change", carregarBaralla)

  carregarBaralla()
}

// carregar nova baralla
function carregarBaralla(){
  const deck=document.getElementById("deck").value
  barallaActual=[...MANIFEST[deck]]
  barallaRestant=shuffle([...barallaActual])
  novaCarta()
}

function novaCarta(){

  if(barallaRestant.length===0){
    barallaRestant = shuffle([...barallaActual])
  }

  const path = barallaRestant.pop()

  const img = document.getElementById("img")

  const url = new URL(path, window.location.href)
  url.searchParams.set("t", Date.now())

  img.src = url.toString()
}

// tecla ENTER
document.addEventListener("keydown", e=>{
  if(e.key==="Enter") novaCarta()
})

init()
</script>

</body>
</html>