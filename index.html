<!doctype html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<title>Cartes Rockin</title>

<style>
body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica;
  background:#f6f7f9;      /* ← fons clar */
  color:#222;             /* ← text fosc */
  text-align:center;
  margin:0;
  padding:30px;
}

h1{
  margin:0 0 20px 0;
  font-size:30px;
  font-weight:600;
}

.controls{
  margin-bottom:20px;
}

select, button{
  font-size:18px;
  padding:12px 18px;
  border-radius:12px;
  margin:6px;
}

select{
  border:1px solid #ccc;
  background:white;
}

button{
  background:#ffcc00;
  border:none;
  font-weight:bold;
  cursor:pointer;
  transition: transform .05s ease, box-shadow .1s ease;
}

button:hover{
  transform: translateY(-1px);
  box-shadow:0 4px 10px rgba(0,0,0,.15);
}

img{
  max-width:95%;
  max-height:75vh;
  border-radius:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.25); /* ombra més suau */
  background:white;
}

.info{
  margin-top:14px;
  opacity:.6;
  font-size:14px;
}
</style>
</head>

<body>

<h1>Cartes Rockin</h1>

<div class="controls">
  <select id="deck"></select>
  <button onclick="novaCarta()">Nova carta</button>
</div>

<img id="img">

<div class="info">
Prem ENTER per treure una nova carta
</div>

<script>
let MANIFEST = {}
let barallaActual = []
let barallaRestant = []

// barrejar array
function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1))
    ;[array[i],array[j]]=[array[j],array[i]]
  }
  return array
}

// carregar manifest
async function init(){
  const res = await fetch("manifest.json")
  MANIFEST = await res.json()

  const select = document.getElementById("deck")

  Object.keys(MANIFEST).forEach(b=>{
    const opt=document.createElement("option")
    opt.value=b
    opt.textContent=b
    select.appendChild(opt)
  })

  select.addEventListener("change", carregarBaralla)

  carregarBaralla()
}

// carregar nova baralla
function carregarBaralla(){
  const deck=document.getElementById("deck").value
  barallaActual=[...MANIFEST[deck]]
  barallaRestant=shuffle([...barallaActual])
  novaCarta()
}

// treure carta
function novaCarta(){

  if(barallaRestant.length===0){
    barallaRestant = shuffle([...barallaActual])
  }

  const path = barallaRestant.pop()

  const img = document.getElementById("img")

  // URL robusta (funciona amb GitHub Pages i subcarpetes)
  const url = new URL(path, window.location.href)
  url.searchParams.set("t", Date.now())

  img.src = url.toString()
}

// tecla ENTER
document.addEventListener("keydown", e=>{
  if(e.key==="Enter") novaCarta()
})

init()
</script>

</body>
</html>