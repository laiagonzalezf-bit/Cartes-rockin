<!doctype html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<title>Cartes Rockin</title>

<style>
body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica;
  background:#f6f7f9;
  color:#222;
  text-align:center;
  margin:0;
  padding:30px;
}

h1{
  margin:0 0 18px 0;
  font-size:30px;
  font-weight:600;
}

.controls{
  margin-bottom:20px;
}

select, button{
  font-size:18px;
  padding:12px 18px;
  border-radius:12px;
  margin:6px;
}

button{
  background:#ffcc00;
  border:none;
  font-weight:bold;
  cursor:pointer;
}

/* ---------- ESCENARI 3D ---------- */

.stage{
  width:min(92vw, 900px);
  margin:auto;
  perspective:1200px;
}

.card{
  position:relative;
  width:100%;
  height:min(75vh, 700px);
  transform-style:preserve-3d;
  transition: transform .6s cubic-bezier(.2,.8,.2,1);
  cursor:pointer;
}

/* gir */
.card.flip{
  transform: rotateY(180deg);
}

/* cares */
.face{
  position:absolute;
  width:100%;
  height:100%;
  backface-visibility:hidden;
  border-radius:18px;
  overflow:hidden;
  background:white;
  box-shadow:0 10px 30px rgba(0,0,0,.2);
  display:flex;
  align-items:center;
  justify-content:center;
}

.face img{
  width:100%;
  height:100%;
  object-fit:contain;
}

/* darrere (es veu quan gira) */
.back{
  transform: rotateY(180deg);
  background:linear-gradient(135deg,#e9ecef,#d7dde5);
  font-size:22px;
  font-weight:600;
  color:#666;
}

.info{
  margin-top:14px;
  opacity:.6;
  font-size:14px;
}
</style>
</head>

<body>

<h1>Cartes Rockin</h1>

<div class="controls">
  <select id="deck"></select>
  <button onclick="novaCarta()">Nova carta</button>
</div>

<div class="stage">

  <div class="card" id="card">

    <!-- cara frontal -->
    <div class="face front">
      <img id="imgFront">
    </div>

    <!-- cara del darrere -->
    <div class="face back">
      ðŸŽµ
    </div>

  </div>

  <div class="info">Prem ENTER o fes clic a la carta</div>
</div>

<script>
let MANIFEST = {}
let barallaActual = []
let barallaRestant = []

function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1))
    ;[array[i],array[j]]=[array[j],array[i]]
  }
  return array
}

async function init(){
  const res = await fetch("manifest.json")
  MANIFEST = await res.json()

  const select = document.getElementById("deck")

  Object.keys(MANIFEST).forEach(b=>{
    const opt=document.createElement("option")
    opt.value=b
    opt.textContent=b
    select.appendChild(opt)
  })

  select.addEventListener("change", carregarBaralla)

  document.getElementById("card").onclick = novaCarta

  carregarBaralla()
}

function carregarBaralla(){
  const deck=document.getElementById("deck").value
  barallaActual=[...MANIFEST[deck]]
  barallaRestant=shuffle([...barallaActual])
  novaCarta()
}

function setImg(path){
  const img = document.getElementById("imgFront")
  const url = new URL(path, window.location.href)
  url.searchParams.set("t", Date.now())
  img.src = url.toString()
}

function novaCarta(){

  if(barallaRestant.length===0){
    barallaRestant = shuffle([...barallaActual])
  }

  const path = barallaRestant.pop()

  const card = document.getElementById("card")

  // girar
  card.classList.add("flip")

  // quan estÃ  girada (mig segon), canviem imatge
  setTimeout(()=>{
    setImg(path)
  }, 300)

  // tornar a lloc
  setTimeout(()=>{
    card.classList.remove("flip")
  }, 600)
}

document.addEventListener("keydown", e=>{
  if(e.key==="Enter") novaCarta()
})

init()
</script>

</body>
</html>